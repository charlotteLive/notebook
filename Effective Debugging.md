# Effective Debugging

## 1. 调试符号和调试器

为了具有完全的源码级别调试能力，编译器需要生成许多调试符号信息，它们可以根据描述的对象分类。

- 全局函数和变量
- 源文件和行信息
- 类型信息
- 静态函数和局部变量
- 架构和编译器依赖信息

编译代码时，添加`-g`或`-ggdb`的编译选项，指示编译器生成调试符号，调试符号会被分为多个模块保存到输出文件的debug section里。可以使用`readelf –-debug-dump foo.o`类似的命令来解析输出文件的调试符号。

- `.debug_abbrew`，这个表描述了减少DWARF文件大小的编码算法。
- `.debug_info`，它包含了调试符号的核心，数据类型的信息、变量、函数等等。
- `.debug_line`，存放了源代码行号的调试符号。
- `.debug_aranges`，说明了每个编译单元的地址范围。





缺少调试符号时，我们可以自己编译或准备一个新的带有调试符号的库文件，然后使用GDB的`add-symbol-file`命令从输入文件读入额外的调试符号。

```sh
gdb) add-symbol-file /home/myan/bin/sh_symbols.o 0x3f68700000
(gdb) print *(FreeBlock*)0x290c098
$1 = {
  sizeAndTags = 490,
  next = 0x290d560,
  prev = 0x290ffe8
}
```

这个方法让用户在使用调试器解释数据的时候具有更多的灵活性。但是它仅仅可以提供额外的类型信息，它不可替换其他的调试符号如行号或者变量位置，这些是原始二进制生成的编译时期确定。



